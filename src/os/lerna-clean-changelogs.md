---
layout: package
title: lerna-clean-changelogs
packages:
  - lerna-clean-changelogs-cli
---

## Purpose

This program removes the frivolous changelog file entries generated by [commitizen](https://www.npmjs.com/package/git-cz):

![cleaning](/images/package-lerna-clean-changelogs-deleted.png)

It is used in a Lerna monorepos environment.

{% include "btt.njk" %}

## API

::: api
cleanChangelogs(str)
:::

In other words, a function takes one, obligatory argument, a string.

This library is **deliberately decoupled from the file read/write operations** because of [_separation of concerns_](https://en.wikipedia.org/wiki/Separation_of_concerns).

{% include "btt.njk" %}

## API - Output

A plain object is returned and it contains the following keys:

| Key's name | Key value's type | Description                                                          |
| ---------- | ---------------- | -------------------------------------------------------------------- |
| `version`  | String           | Version as present currently in `package.json`. For example, `1.0.0` |
| `res`      | String           | The string you gave in the input, just cleaned.                      |

for example,

```js
{
  res: "some text",
  version: "1.3.56",
}
```

{% include "btt.njk" %}

## Algorithm

This package performs the following cleaning steps:

1. It removes bump-only changelog entries that `conventional-changelog` generates. There can be many reasons For example:

   ```
   **Note:** Version bump only for package ranges-apply
   ```

   These will be deleted along with their headings.

2. It removes diff links from headings. Change the following:

   ```
   ## [2.9.1](/os/ranges-apply/compare/ranges-apply@2.9.0...ranges-apply@2.9.1) (2018-12-27)
   ```

   into:

   ```
   ## 2.9.1 (2018-12-27)
   ```

   We need to do that because those links don't work on BitBucket and, generally, are _a noise_.

3. Remove `h1` headings and turn them into `h2`, with the exception of the first, main heading of the changelog.

   For exampe, change the following:

   ```
   # [2.0.0](/os/ranges-apply/compare/ranges-apply@2.0.0...ranges-apply@1.9.1) (2018-12-27)
   ```

   into:

   ```
   ## 2.0.0 (2018-12-27)
   ```

   (notice how a second hash character added, beside link being removed)

4. Replaces two or more empty lines into one line. `conventional-changelog` itself leaves excessive whitespace. As a bonus, if line only contains whitespace characters (spaces, tabs etc.) those whitespace characters are removed. They're hard to spot but useless.

5. If existing, pre-lerna changelog entries use dashes to note list items, those dashes are updated to match `conventional-changelog` notation using asterisks.

6. On Sourcehut, links are generated with plural, `/commits/`, for example: `https://git.sr.ht/~user/project/commits/abcdef` which lead to 404. This program replaces `/commits/` with `/commit/` if it detects a matching `git.sr.ht/`-domain URL.

{% include "btt.njk" %}
